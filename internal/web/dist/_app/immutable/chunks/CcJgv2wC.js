import{w as ge,g as Q,p as J,T as he,c as F,r as L,a as q,b as K,d as fe,e as me,l as ve,f as B,h as ye,A as V,i as _e,j as be,k as Ce,U as X,m as te,n as O,o as Ee,z as M}from"./p6dsmFtl.js";import{o as a,n as I,s as r,a as R,b as $,_ as A,r as Te,u as re,c as Ie}from"./pRZOK57-.js";var Re="3.0.22",Se=O(()=>M(a({error:a({code:I().nullable(),message:r(),status:r()})}))),U=Ee({errorSchema:Se,errorToMessage:e=>e.error.message}),we=O(()=>M(a({outputDimensionality:I().optional(),taskType:A(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}))),xe=class{constructor(e,s){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=s}get provider(){return this.config.provider}async doEmbed({values:e,headers:s,abortSignal:u,providerOptions:g}){const i=await J({provider:"google",providerOptions:g,schema:we});if(e.length>this.maxEmbeddingsPerCall)throw new he({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const b=F(await L(this.config.headers),s);if(e.length===1){const{responseHeaders:h,value:f,rawValue:d}=await q({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:b,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:U,successfulResponseHandler:B(Me),abortSignal:u,fetch:this.config.fetch});return{warnings:[],embeddings:[f.embedding.values],usage:void 0,response:{headers:h,body:d}}}const{responseHeaders:m,value:v,rawValue:p}=await q({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:b,body:{requests:e.map(h=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:h}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:U,successfulResponseHandler:B(Oe),abortSignal:u,fetch:this.config.fetch});return{warnings:[],embeddings:v.embeddings.map(h=>h.values),usage:void 0,response:{headers:m,body:p}}}},Oe=O(()=>M(a({embeddings:R(a({values:R(I())}))}))),Me=O(()=>M(a({embedding:a({values:R(I())})})));function oe(e){var s,u,g,i;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const b=(s=e.promptTokenCount)!=null?s:0,m=(u=e.candidatesTokenCount)!=null?u:0,v=(g=e.cachedContentTokenCount)!=null?g:0,p=(i=e.thoughtsTokenCount)!=null?i:0;return{inputTokens:{total:b,noCache:b-v,cacheRead:v,cacheWrite:void 0},outputTokens:{total:m+p,text:m,reasoning:p},raw:e}}function k(e,s=!0){if(e==null)return;if(Ae(e))return s?void 0:typeof e=="object"&&e.description?{type:"object",description:e.description}:{type:"object"};if(typeof e=="boolean")return{type:"boolean",properties:{}};const{type:u,description:g,required:i,properties:b,items:m,allOf:v,anyOf:p,oneOf:h,format:f,const:d,minLength:o,enum:t}=e,l={};if(g&&(l.description=g),i&&(l.required=i),f&&(l.format=f),d!==void 0&&(l.enum=[d]),u)if(Array.isArray(u)){const n=u.includes("null"),c=u.filter(C=>C!=="null");c.length===0?l.type="null":(l.anyOf=c.map(C=>({type:C})),n&&(l.nullable=!0))}else l.type=u;if(t!==void 0&&(l.enum=t),b!=null&&(l.properties=Object.entries(b).reduce((n,[c,C])=>(n[c]=k(C,!1),n),{})),m&&(l.items=Array.isArray(m)?m.map(n=>k(n,!1)):k(m,!1)),v&&(l.allOf=v.map(n=>k(n,!1))),p)if(p.some(n=>typeof n=="object"&&n?.type==="null")){const n=p.filter(c=>!(typeof c=="object"&&c?.type==="null"));if(n.length===1){const c=k(n[0],!1);typeof c=="object"&&(l.nullable=!0,Object.assign(l,c))}else l.anyOf=n.map(c=>k(c,!1)),l.nullable=!0}else l.anyOf=p.map(n=>k(n,!1));return h&&(l.oneOf=h.map(n=>k(n,!1))),o!==void 0&&(l.minLength=o),l}function Ae(e){return e!=null&&typeof e=="object"&&e.type==="object"&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Ne(e,s){var u,g,i;const b=[],m=[];let v=!0;const p=(u=s?.isGemmaModel)!=null?u:!1,h=(g=s?.providerOptionsName)!=null?g:"google";for(const{role:f,content:d}of e)switch(f){case"system":{if(!v)throw new X({functionality:"system messages are only supported at the beginning of the conversation"});b.push({text:d});break}case"user":{v=!1;const o=[];for(const t of d)switch(t.type){case"text":{o.push({text:t.text});break}case"file":{const l=t.mediaType==="image/*"?"image/jpeg":t.mediaType;o.push(t.data instanceof URL?{fileData:{mimeType:l,fileUri:t.data.toString()}}:{inlineData:{mimeType:l,data:te(t.data)}});break}}m.push({role:"user",parts:o});break}case"assistant":{v=!1,m.push({role:"model",parts:d.map(o=>{var t;const l=(t=o.providerOptions)==null?void 0:t[h],n=l?.thoughtSignature!=null?String(l.thoughtSignature):void 0;switch(o.type){case"text":return o.text.length===0?void 0:{text:o.text,thoughtSignature:n};case"reasoning":return o.text.length===0?void 0:{text:o.text,thought:!0,thoughtSignature:n};case"file":{if(o.data instanceof URL)throw new X({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:o.mediaType,data:te(o.data)},thoughtSignature:n}}case"tool-call":return{functionCall:{name:o.toolName,args:o.input},thoughtSignature:n}}}).filter(o=>o!==void 0)});break}case"tool":{v=!1;const o=[];for(const t of d){if(t.type==="tool-approval-response")continue;const l=t.output;if(l.type==="content")for(const n of l.value)switch(n.type){case"text":o.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.text}}});break;case"image-data":o.push({inlineData:{mimeType:n.mediaType,data:n.data}},{text:"Tool executed successfully and returned this image as a response"});break;default:o.push({text:JSON.stringify(n)});break}else o.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:l.type==="execution-denied"?(i=l.reason)!=null?i:"Tool execution denied.":l.value}}})}m.push({role:"user",parts:o});break}}if(p&&b.length>0&&m.length>0&&m[0].role==="user"){const f=b.map(d=>d.text).join(`

`);m[0].parts.unshift({text:f+`

`})}return{systemInstruction:b.length>0&&!p?{parts:b}:void 0,contents:m}}function ne(e){return e.includes("/")?e:`models/${e}`}var ie=O(()=>M(a({responseModalities:R(A(["TEXT","IMAGE"])).optional(),thinkingConfig:a({thinkingBudget:I().optional(),includeThoughts:$().optional(),thinkingLevel:A(["minimal","low","medium","high"]).optional()}).optional(),cachedContent:r().optional(),structuredOutputs:$().optional(),safetySettings:R(a({category:A(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:A(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:A(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:$().optional(),labels:Te(r(),r()).optional(),mediaResolution:A(["MEDIA_RESOLUTION_UNSPECIFIED","MEDIA_RESOLUTION_LOW","MEDIA_RESOLUTION_MEDIUM","MEDIA_RESOLUTION_HIGH"]).optional(),imageConfig:a({aspectRatio:A(["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"]).optional(),imageSize:A(["1K","2K","4K"]).optional()}).optional(),retrievalConfig:a({latLng:a({latitude:I(),longitude:I()}).optional()}).optional()})));function Ge({tools:e,toolChoice:s,modelId:u}){var g;e=e?.length?e:void 0;const i=[],b=["gemini-flash-latest","gemini-flash-lite-latest","gemini-pro-latest"].some(t=>t===u),m=u.includes("gemini-2")||u.includes("gemini-3")||b,v=u.includes("gemini-1.5-flash")&&!u.includes("-8b"),p=u.includes("gemini-2.5")||u.includes("gemini-3");if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};const h=e.some(t=>t.type==="function"),f=e.some(t=>t.type==="provider");if(h&&f&&i.push({type:"unsupported",feature:"combination of function and provider-defined tools"}),f){const t=[];return e.filter(n=>n.type==="provider").forEach(n=>{switch(n.id){case"google.google_search":m?t.push({googleSearch:{}}):v?t.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:n.args.mode,dynamicThreshold:n.args.dynamicThreshold}}}):t.push({googleSearchRetrieval:{}});break;case"google.enterprise_web_search":m?t.push({enterpriseWebSearch:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"Enterprise Web Search requires Gemini 2.0 or newer."});break;case"google.url_context":m?t.push({urlContext:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":m?t.push({codeExecution:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;case"google.file_search":p?t.push({fileSearch:{...n.args}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"The file search tool is only supported with Gemini 2.5 models and Gemini 3 models."});break;case"google.vertex_rag_store":m?t.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:n.args.ragCorpus},similarity_top_k:n.args.topK}}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"The RAG store tool is not supported with other Gemini models than Gemini 2."});break;case"google.google_maps":m?t.push({googleMaps:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`,details:"The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer."});break;default:i.push({type:"unsupported",feature:`provider-defined tool ${n.id}`});break}}),{tools:t.length>0?t:void 0,toolConfig:void 0,toolWarnings:i}}const d=[];for(const t of e)t.type==="function"?d.push({name:t.name,description:(g=t.description)!=null?g:"",parameters:k(t.inputSchema)}):i.push({type:"unsupported",feature:`function tool ${t.name}`});if(s==null)return{tools:[{functionDeclarations:d}],toolConfig:void 0,toolWarnings:i};const o=s.type;switch(o){case"auto":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:i};case"none":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:i};case"required":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:i};case"tool":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[s.toolName]}},toolWarnings:i};default:{const t=o;throw new X({functionality:`tool choice type: ${t}`})}}}function ae({finishReason:e,hasToolCalls:s}){switch(e){case"STOP":return s?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"MALFORMED_FUNCTION_CALL":return"error";default:return"other"}}var ke=class{constructor(e,s){this.specificationVersion="v3";var u;this.modelId=e,this.config=s,this.generateId=(u=s.generateId)!=null?u:Q}get provider(){return this.config.provider}get supportedUrls(){var e,s,u;return(u=(s=(e=this.config).supportedUrls)==null?void 0:s.call(e))!=null?u:{}}async getArgs({prompt:e,maxOutputTokens:s,temperature:u,topP:g,topK:i,frequencyPenalty:b,presencePenalty:m,stopSequences:v,responseFormat:p,seed:h,tools:f,toolChoice:d,providerOptions:o}){var t;const l=[],n=this.config.provider.includes("vertex")?"vertex":"google";let c=await J({provider:n,providerOptions:o,schema:ie});c==null&&n!=="google"&&(c=await J({provider:"google",providerOptions:o,schema:ie})),f?.some(y=>y.type==="provider"&&y.id==="google.vertex_rag_store")&&!this.config.provider.startsWith("google.vertex.")&&l.push({type:"other",message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const C=this.modelId.toLowerCase().startsWith("gemma-"),{contents:E,systemInstruction:G}=Ne(e,{isGemmaModel:C,providerOptionsName:n}),{tools:S,toolConfig:x,toolWarnings:N}=Ge({tools:f,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:s,temperature:u,topK:i,topP:g,frequencyPenalty:b,presencePenalty:m,stopSequences:v,seed:h,responseMimeType:p?.type==="json"?"application/json":void 0,responseSchema:p?.type==="json"&&p.schema!=null&&((t=c?.structuredOutputs)==null||t)?k(p.schema):void 0,...c?.audioTimestamp&&{audioTimestamp:c.audioTimestamp},responseModalities:c?.responseModalities,thinkingConfig:c?.thinkingConfig,...c?.mediaResolution&&{mediaResolution:c.mediaResolution},...c?.imageConfig&&{imageConfig:c.imageConfig}},contents:E,systemInstruction:C?void 0:G,safetySettings:c?.safetySettings,tools:S,toolConfig:c?.retrievalConfig?{...x,retrievalConfig:c.retrievalConfig}:x,cachedContent:c?.cachedContent,labels:c?.labels},warnings:[...l,...N],providerOptionsName:n}}async doGenerate(e){var s,u,g,i,b,m,v,p,h;const{args:f,warnings:d,providerOptionsName:o}=await this.getArgs(e),t=F(await L(this.config.headers),e.headers),{responseHeaders:l,value:n,rawValue:c}=await q({url:`${this.config.baseURL}/${ne(this.modelId)}:generateContent`,headers:t,body:f,failedResponseHandler:U,successfulResponseHandler:B(Le),abortSignal:e.abortSignal,fetch:this.config.fetch}),C=n.candidates[0],E=[],G=(u=(s=C.content)==null?void 0:s.parts)!=null?u:[],S=n.usageMetadata;let x;for(const y of G)if("executableCode"in y&&((g=y.executableCode)!=null&&g.code)){const D=this.config.generateId();x=D,E.push({type:"tool-call",toolCallId:D,toolName:"code_execution",input:JSON.stringify(y.executableCode),providerExecuted:!0})}else"codeExecutionResult"in y&&y.codeExecutionResult?(E.push({type:"tool-result",toolCallId:x,toolName:"code_execution",result:{outcome:y.codeExecutionResult.outcome,output:y.codeExecutionResult.output}}),x=void 0):"text"in y&&y.text!=null&&y.text.length>0?E.push({type:y.thought===!0?"reasoning":"text",text:y.text,providerMetadata:y.thoughtSignature?{[o]:{thoughtSignature:y.thoughtSignature}}:void 0}):"functionCall"in y?E.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:y.functionCall.name,input:JSON.stringify(y.functionCall.args),providerMetadata:y.thoughtSignature?{[o]:{thoughtSignature:y.thoughtSignature}}:void 0}):"inlineData"in y&&E.push({type:"file",data:y.inlineData.data,mediaType:y.inlineData.mimeType,providerMetadata:y.thoughtSignature?{[o]:{thoughtSignature:y.thoughtSignature}}:void 0});const N=(i=se({groundingMetadata:C.groundingMetadata,generateId:this.config.generateId}))!=null?i:[];for(const y of N)E.push(y);return{content:E,finishReason:{unified:ae({finishReason:C.finishReason,hasToolCalls:E.some(y=>y.type==="tool-call"&&!y.providerExecuted)}),raw:(b=C.finishReason)!=null?b:void 0},usage:oe(S),warnings:d,providerMetadata:{[o]:{promptFeedback:(m=n.promptFeedback)!=null?m:null,groundingMetadata:(v=C.groundingMetadata)!=null?v:null,urlContextMetadata:(p=C.urlContextMetadata)!=null?p:null,safetyRatings:(h=C.safetyRatings)!=null?h:null,usageMetadata:S??null}},request:{body:f},response:{headers:l,body:c}}}async doStream(e){const{args:s,warnings:u,providerOptionsName:g}=await this.getArgs(e),i=F(await L(this.config.headers),e.headers),{responseHeaders:b,value:m}=await q({url:`${this.config.baseURL}/${ne(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:s,failedResponseHandler:U,successfulResponseHandler:Ce(Ue),abortSignal:e.abortSignal,fetch:this.config.fetch});let v={unified:"other",raw:void 0},p,h;const f=this.config.generateId;let d=!1,o=null,t=null,l=0;const n=new Set;let c;return{stream:m.pipeThrough(new TransformStream({start(C){C.enqueue({type:"stream-start",warnings:u})},transform(C,E){var G,S,x,N,y,D,W;if(e.includeRawChunks&&E.enqueue({type:"raw",rawValue:C.rawValue}),!C.success){E.enqueue({type:"error",error:C.error});return}const H=C.value,T=H.usageMetadata;T!=null&&(p=T);const w=(G=H.candidates)==null?void 0:G[0];if(w==null)return;const Y=w.content,Z=se({groundingMetadata:w.groundingMetadata,generateId:f});if(Z!=null)for(const P of Z)P.sourceType==="url"&&!n.has(P.url)&&(n.add(P.url),E.enqueue(P));if(Y!=null){const P=(S=Y.parts)!=null?S:[];for(const _ of P)if("executableCode"in _&&((x=_.executableCode)!=null&&x.code)){const j=f();c=j,E.enqueue({type:"tool-call",toolCallId:j,toolName:"code_execution",input:JSON.stringify(_.executableCode),providerExecuted:!0})}else if("codeExecutionResult"in _&&_.codeExecutionResult){const j=c;j&&(E.enqueue({type:"tool-result",toolCallId:j,toolName:"code_execution",result:{outcome:_.codeExecutionResult.outcome,output:_.codeExecutionResult.output}}),c=void 0)}else"text"in _&&_.text!=null&&_.text.length>0?_.thought===!0?(o!==null&&(E.enqueue({type:"text-end",id:o}),o=null),t===null&&(t=String(l++),E.enqueue({type:"reasoning-start",id:t,providerMetadata:_.thoughtSignature?{[g]:{thoughtSignature:_.thoughtSignature}}:void 0})),E.enqueue({type:"reasoning-delta",id:t,delta:_.text,providerMetadata:_.thoughtSignature?{[g]:{thoughtSignature:_.thoughtSignature}}:void 0})):(t!==null&&(E.enqueue({type:"reasoning-end",id:t}),t=null),o===null&&(o=String(l++),E.enqueue({type:"text-start",id:o,providerMetadata:_.thoughtSignature?{[g]:{thoughtSignature:_.thoughtSignature}}:void 0})),E.enqueue({type:"text-delta",id:o,delta:_.text,providerMetadata:_.thoughtSignature?{[g]:{thoughtSignature:_.thoughtSignature}}:void 0})):"inlineData"in _&&E.enqueue({type:"file",mediaType:_.inlineData.mimeType,data:_.inlineData.data});const ee=De({parts:Y.parts,generateId:f,providerOptionsName:g});if(ee!=null)for(const _ of ee)E.enqueue({type:"tool-input-start",id:_.toolCallId,toolName:_.toolName,providerMetadata:_.providerMetadata}),E.enqueue({type:"tool-input-delta",id:_.toolCallId,delta:_.args,providerMetadata:_.providerMetadata}),E.enqueue({type:"tool-input-end",id:_.toolCallId,providerMetadata:_.providerMetadata}),E.enqueue({type:"tool-call",toolCallId:_.toolCallId,toolName:_.toolName,input:_.args,providerMetadata:_.providerMetadata}),d=!0}w.finishReason!=null&&(v={unified:ae({finishReason:w.finishReason,hasToolCalls:d}),raw:w.finishReason},h={[g]:{promptFeedback:(N=H.promptFeedback)!=null?N:null,groundingMetadata:(y=w.groundingMetadata)!=null?y:null,urlContextMetadata:(D=w.urlContextMetadata)!=null?D:null,safetyRatings:(W=w.safetyRatings)!=null?W:null}},T!=null&&(h[g].usageMetadata=T))},flush(C){o!==null&&C.enqueue({type:"text-end",id:o}),t!==null&&C.enqueue({type:"reasoning-end",id:t}),C.enqueue({type:"finish",finishReason:v,usage:oe(p),providerMetadata:h})}})),response:{headers:b},request:{body:s}}}};function De({parts:e,generateId:s,providerOptionsName:u}){const g=e?.filter(i=>"functionCall"in i);return g==null||g.length===0?void 0:g.map(i=>({type:"tool-call",toolCallId:s(),toolName:i.functionCall.name,args:JSON.stringify(i.functionCall.args),providerMetadata:i.thoughtSignature?{[u]:{thoughtSignature:i.thoughtSignature}}:void 0}))}function se({groundingMetadata:e,generateId:s}){var u,g,i,b,m;if(!e?.groundingChunks)return;const v=[];for(const p of e.groundingChunks)if(p.web!=null)v.push({type:"source",sourceType:"url",id:s(),url:p.web.uri,title:(u=p.web.title)!=null?u:void 0});else if(p.retrievedContext!=null){const h=p.retrievedContext.uri,f=p.retrievedContext.fileSearchStore;if(h&&(h.startsWith("http://")||h.startsWith("https://")))v.push({type:"source",sourceType:"url",id:s(),url:h,title:(g=p.retrievedContext.title)!=null?g:void 0});else if(h){const d=(i=p.retrievedContext.title)!=null?i:"Unknown Document";let o="application/octet-stream",t;h.endsWith(".pdf")?(o="application/pdf",t=h.split("/").pop()):h.endsWith(".txt")?(o="text/plain",t=h.split("/").pop()):h.endsWith(".docx")?(o="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t=h.split("/").pop()):h.endsWith(".doc")?(o="application/msword",t=h.split("/").pop()):(h.match(/\.(md|markdown)$/)&&(o="text/markdown"),t=h.split("/").pop()),v.push({type:"source",sourceType:"document",id:s(),mediaType:o,title:d,filename:t})}else if(f){const d=(b=p.retrievedContext.title)!=null?b:"Unknown Document";v.push({type:"source",sourceType:"document",id:s(),mediaType:"application/octet-stream",title:d,filename:f.split("/").pop()})}}else p.maps!=null&&p.maps.uri&&v.push({type:"source",sourceType:"url",id:s(),url:p.maps.uri,title:(m=p.maps.title)!=null?m:void 0});return v.length>0?v:void 0}var ue=()=>a({webSearchQueries:R(r()).nullish(),retrievalQueries:R(r()).nullish(),searchEntryPoint:a({renderedContent:r()}).nullish(),groundingChunks:R(a({web:a({uri:r(),title:r().nullish()}).nullish(),retrievedContext:a({uri:r().nullish(),title:r().nullish(),text:r().nullish(),fileSearchStore:r().nullish()}).nullish(),maps:a({uri:r().nullish(),title:r().nullish(),text:r().nullish(),placeId:r().nullish()}).nullish()})).nullish(),groundingSupports:R(a({segment:a({startIndex:I().nullish(),endIndex:I().nullish(),text:r().nullish()}).nullish(),segment_text:r().nullish(),groundingChunkIndices:R(I()).nullish(),supportChunkIndices:R(I()).nullish(),confidenceScores:R(I()).nullish(),confidenceScore:R(I()).nullish()})).nullish(),retrievalMetadata:re([a({webDynamicRetrievalScore:I()}),a({})]).nullish()}),de=()=>a({parts:R(re([a({functionCall:a({name:r(),args:Ie()}),thoughtSignature:r().nullish()}),a({inlineData:a({mimeType:r(),data:r()}),thoughtSignature:r().nullish()}),a({executableCode:a({language:r(),code:r()}).nullish(),codeExecutionResult:a({outcome:r(),output:r()}).nullish(),text:r().nullish(),thought:$().nullish(),thoughtSignature:r().nullish()})])).nullish()}),z=()=>a({category:r().nullish(),probability:r().nullish(),probabilityScore:I().nullish(),severity:r().nullish(),severityScore:I().nullish(),blocked:$().nullish()}),ce=a({cachedContentTokenCount:I().nullish(),thoughtsTokenCount:I().nullish(),promptTokenCount:I().nullish(),candidatesTokenCount:I().nullish(),totalTokenCount:I().nullish(),trafficType:r().nullish()}),pe=()=>a({urlMetadata:R(a({retrievedUrl:r(),urlRetrievalStatus:r()}))}),Le=O(()=>M(a({candidates:R(a({content:de().nullish().or(a({}).strict()),finishReason:r().nullish(),safetyRatings:R(z()).nullish(),groundingMetadata:ue().nullish(),urlContextMetadata:pe().nullish()})),usageMetadata:ce.nullish(),promptFeedback:a({blockReason:r().nullish(),safetyRatings:R(z()).nullish()}).nullish()}))),Ue=O(()=>M(a({candidates:R(a({content:de().nullish(),finishReason:r().nullish(),safetyRatings:R(z()).nullish(),groundingMetadata:ue().nullish(),urlContextMetadata:pe().nullish()})).nullish(),usageMetadata:ce.nullish(),promptFeedback:a({blockReason:r().nullish(),safetyRatings:R(z()).nullish()}).nullish()}))),He=fe({id:"google.code_execution",inputSchema:a({language:r().describe("The programming language of the code."),code:r().describe("The code to be executed.")}),outputSchema:a({outcome:r().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:r().describe("The output from the code execution.")})}),Pe=K({id:"google.enterprise_web_search",inputSchema:O(()=>M(a({})))}),Ve=a({fileSearchStoreNames:R(r()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:I().int().positive().describe("The number of file search retrieval chunks to retrieve.").optional(),metadataFilter:r().describe("Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.").optional()}).passthrough(),$e=O(()=>M(Ve)),Fe=K({id:"google.file_search",inputSchema:$e}),qe=K({id:"google.google_maps",inputSchema:O(()=>M(a({})))}),Be=K({id:"google.google_search",inputSchema:O(()=>M(a({mode:A(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:I().default(1)})))}),Ke=K({id:"google.url_context",inputSchema:O(()=>M(a({})))}),We=K({id:"google.vertex_rag_store",inputSchema:a({ragCorpus:r(),topK:I().optional()})}),Ye={googleSearch:Be,enterpriseWebSearch:Pe,googleMaps:qe,urlContext:Ke,fileSearch:Fe,codeExecution:He,vertexRagStore:We},je=class{constructor(e,s,u){this.modelId=e,this.settings=s,this.config=u,this.specificationVersion="v3"}get maxImagesPerCall(){var e;return(e=this.settings.maxImagesPerCall)!=null?e:4}get provider(){return this.config.provider}async doGenerate(e){var s,u,g;const{prompt:i,n:b=1,size:m,aspectRatio:v="1:1",seed:p,providerOptions:h,headers:f,abortSignal:d,files:o,mask:t}=e,l=[];if(o!=null&&o.length>0)throw new Error("Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");if(t!=null)throw new Error("Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");m!=null&&l.push({type:"unsupported",feature:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),p!=null&&l.push({type:"unsupported",feature:"seed",details:"This model does not support the `seed` option through this provider."});const n=await J({provider:"google",providerOptions:h,schema:ze}),c=(g=(u=(s=this.config._internal)==null?void 0:s.currentDate)==null?void 0:u.call(s))!=null?g:new Date,C={sampleCount:b};v!=null&&(C.aspectRatio=v),n&&Object.assign(C,n);const E={instances:[{prompt:i}],parameters:C},{responseHeaders:G,value:S}=await q({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:F(await L(this.config.headers),f),body:E,failedResponseHandler:U,successfulResponseHandler:B(Je),abortSignal:d,fetch:this.config.fetch});return{images:S.predictions.map(x=>x.bytesBase64Encoded),warnings:l??[],providerMetadata:{google:{images:S.predictions.map(x=>({}))}},response:{timestamp:c,modelId:this.modelId,headers:G}}}},Je=O(()=>M(a({predictions:R(a({bytesBase64Encoded:r()})).default([])}))),ze=O(()=>M(a({personGeneration:A(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:A(["1:1","3:4","4:3","9:16","16:9"]).nullish()}))),Qe=class{constructor(e,s){this.modelId=e,this.config=s,this.specificationVersion="v3"}get provider(){return this.config.provider}get maxVideosPerCall(){return 4}async doGenerate(e){var s,u,g,i,b,m,v,p;const h=(g=(u=(s=this.config._internal)==null?void 0:s.currentDate)==null?void 0:u.call(s))!=null?g:new Date,f=[],d=await J({provider:"google",providerOptions:e.providerOptions,schema:Xe}),o=[{}],t=o[0];if(e.prompt!=null&&(t.prompt=e.prompt),e.image!=null)if(e.image.type==="url")f.push({type:"unsupported",feature:"URL-based image input",details:"Google Generative AI video models require base64-encoded images. URL will be ignored."});else{const T=typeof e.image.data=="string"?e.image.data:ye(e.image.data);t.image={inlineData:{mimeType:e.image.mediaType||"image/png",data:T}}}d?.referenceImages!=null&&(t.referenceImages=d.referenceImages.map(T=>T.bytesBase64Encoded?{inlineData:{mimeType:"image/png",data:T.bytesBase64Encoded}}:T.gcsUri?{gcsUri:T.gcsUri}:T));const l={sampleCount:e.n};if(e.aspectRatio&&(l.aspectRatio=e.aspectRatio),e.resolution){const T={"1280x720":"720p","1920x1080":"1080p","3840x2160":"4k"};l.resolution=T[e.resolution]||e.resolution}if(e.duration&&(l.durationSeconds=e.duration),e.seed&&(l.seed=e.seed),d!=null){const T=d;T.personGeneration!==void 0&&T.personGeneration!==null&&(l.personGeneration=T.personGeneration),T.negativePrompt!==void 0&&T.negativePrompt!==null&&(l.negativePrompt=T.negativePrompt);for(const[w,Y]of Object.entries(T))["pollIntervalMs","pollTimeoutMs","personGeneration","negativePrompt","referenceImages"].includes(w)||(l[w]=Y)}const{value:n}=await q({url:`${this.config.baseURL}/models/${this.modelId}:predictLongRunning`,headers:F(await L(this.config.headers),e.headers),body:{instances:o,parameters:l},successfulResponseHandler:B(le),failedResponseHandler:U,abortSignal:e.abortSignal,fetch:this.config.fetch}),c=n.name;if(!c)throw new V({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:"No operation name returned from API"});const C=(i=d?.pollIntervalMs)!=null?i:1e4,E=(b=d?.pollTimeoutMs)!=null?b:6e5,G=Date.now();let S=n,x;for(;!S.done;){if(Date.now()-G>E)throw new V({name:"GOOGLE_VIDEO_GENERATION_TIMEOUT",message:`Video generation timed out after ${E}ms`});if(await _e(C),(m=e.abortSignal)!=null&&m.aborted)throw new V({name:"GOOGLE_VIDEO_GENERATION_ABORTED",message:"Video generation request was aborted"});const{value:T,responseHeaders:w}=await be({url:`${this.config.baseURL}/${c}`,headers:F(await L(this.config.headers),e.headers),successfulResponseHandler:B(le),failedResponseHandler:U,abortSignal:e.abortSignal,fetch:this.config.fetch});S=T,x=w}if(S.error)throw new V({name:"GOOGLE_VIDEO_GENERATION_FAILED",message:`Video generation failed: ${S.error.message}`});const N=S.response;if(!((v=N?.generateVideoResponse)!=null&&v.generatedSamples)||N.generateVideoResponse.generatedSamples.length===0)throw new V({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:`No videos in response. Response: ${JSON.stringify(S)}`});const y=[],D=[],W=await L(this.config.headers),H=W?.["x-goog-api-key"];for(const T of N.generateVideoResponse.generatedSamples)if((p=T.video)!=null&&p.uri){const w=H?`${T.video.uri}${T.video.uri.includes("?")?"&":"?"}key=${H}`:T.video.uri;y.push({type:"url",url:w,mediaType:"video/mp4"}),D.push({uri:T.video.uri})}if(y.length===0)throw new V({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:"No valid videos in response"});return{videos:y,warnings:f,response:{timestamp:h,modelId:this.modelId,headers:x},providerMetadata:{google:{videos:D}}}}},le=a({name:r().nullish(),done:$().nullish(),error:a({code:I().nullish(),message:r(),status:r().nullish()}).nullish(),response:a({generateVideoResponse:a({generatedSamples:R(a({video:a({uri:r().nullish()}).nullish()})).nullish()}).nullish()}).nullish()}),Xe=O(()=>M(a({pollIntervalMs:I().positive().nullish(),pollTimeoutMs:I().positive().nullish(),personGeneration:A(["dont_allow","allow_adult","allow_all"]).nullish(),negativePrompt:r().nullish(),referenceImages:R(a({bytesBase64Encoded:r().nullish(),gcsUri:r().nullish()})).nullish()}).passthrough()));function Ze(e={}){var s,u;const g=(s=ge(e.baseURL))!=null?s:"https://generativelanguage.googleapis.com/v1beta",i=(u=e.name)!=null?u:"google.generative-ai",b=()=>me({"x-goog-api-key":ve({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers},`ai-sdk/google/${Re}`),m=d=>{var o;return new ke(d,{provider:i,baseURL:g,headers:b,generateId:(o=e.generateId)!=null?o:Q,supportedUrls:()=>({"*":[new RegExp(`^${g}/files/.*$`),new RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),new RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:e.fetch})},v=d=>new xe(d,{provider:i,baseURL:g,headers:b,fetch:e.fetch}),p=(d,o={})=>new je(d,o,{provider:i,baseURL:g,headers:b,fetch:e.fetch}),h=d=>{var o;return new Qe(d,{provider:i,baseURL:g,headers:b,fetch:e.fetch,generateId:(o=e.generateId)!=null?o:Q})},f=function(d){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return m(d)};return f.specificationVersion="v3",f.languageModel=m,f.chat=m,f.generativeAI=m,f.embedding=v,f.embeddingModel=v,f.textEmbedding=v,f.textEmbeddingModel=v,f.image=p,f.imageModel=p,f.video=h,f.videoModel=h,f.tools=Ye,f}Ze();export{Re as VERSION,Ze as createGoogleGenerativeAI};
